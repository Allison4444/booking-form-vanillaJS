(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(e,i){for(var r=0;r<i.length;r++){var o=i[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(void 0,n=function(e,i){if("object"!==t(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!==t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o.key),"symbol"===t(n)?n:String(n)),o)}var n}var i=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._popup=document.querySelector(e),this._button=this._popup.querySelector(".button"),this._handleEscClose=this._handleEscClose.bind(this)}var i,r;return i=t,(r=[{key:"open",value:function(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}},{key:"close",value:function(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}},{key:"_handleEscClose",value:function(t){"Escape"===t.key&&this.close()}},{key:"setEventListeners",value:function(){var t=this;this._button.addEventListener("click",(function(){t.close()})),this._popup.addEventListener("click",(function(e){e.target===e.currentTarget&&t.close()}))}}])&&e(i.prototype,r),Object.defineProperty(i,"prototype",{writable:!1}),t}(),r=[{value:"A",name:"Башня А"},{value:"B",name:"Башня Б"}],o=function(t,e,i){var r=document.createElement("option");r.value=t,r.text=e,r.classList.add("form__option"),i.append(r)};function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function s(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==n(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,"string");if("object"!==n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(r.key),"symbol"===n(o)?o:String(o)),r)}var o}var a=function(){function t(e){var i=e.formSelector,r=e.checkValid,o=e.openPopup;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._form=document.querySelector(i),this._dateInput=this._form.querySelector(".form__date-input"),this._towerSelect=this._form.querySelector("#tower"),this._floorSelect=this._form.querySelector("#floor"),this._textarea=this._form.querySelector(".form__textarea"),this._roomSelect=this._form.querySelector("#room"),this._submitButton=this._form.querySelector(".form__button-submit"),this._resetButton=this._form.querySelector(".form__button-reset"),this._handleSubmit=this._handleSubmit.bind(this),this._handleReset=this._handleReset.bind(this),this._checkValid=r.bind(this),this._openPopup=o}var e,i;return e=t,(i=[{key:"setOptions",value:function(){for(var t=0;t<r.length;t++)o(r[t].value,r[t].name,this._towerSelect);for(var e=3;e<28;e++)o(e,"Этаж ".concat(e),this._floorSelect);for(var i=1;i<11;i++)o(i,"Переговорка ".concat(i),this._roomSelect)}},{key:"setMinAndMaxDate",value:function(){this._today=(new Date).toISOString().split("T")[0],this._tomorrow=Date.parse(this._today)+864e5,this._tomorrowISO=new Date(this._tomorrow).toISOString().split("T")[0],this._dateInput.setAttribute("min",this._tomorrowISO),this._maxDate=new Date,this._maxDate.setFullYear(this._maxDate.getFullYear()+1),this._maxDateISO=this._maxDate.toISOString().split("T")[0],this._dateInput.setAttribute("max",this._maxDateISO)}},{key:"_handleSubmit",value:function(t){t.preventDefault(),this._formData=new FormData(this._form),this._formValues=Object.fromEntries(this._formData.entries()),console.log(JSON.stringify(this._formValues)),this._handleReset(),this._openPopup(),this._checkValid()}},{key:"_handleReset",value:function(){this._form.reset()}},{key:"setEventListeners",value:function(){var t=this;this._submitButton.addEventListener("click",this._handleSubmit),this._resetButton.addEventListener("click",this._handleReset),this._textarea.addEventListener("input",(function(){t._textarea.style.height="auto",t._scrollHeight=t._textarea.scrollHeight,t._textarea.style.height=t._scrollHeight+"px"}))}}])&&s(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}function l(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,c(r.key),r)}}function c(t){var e=function(t,e){if("object"!==u(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,"string");if("object"!==u(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===u(e)?e:String(e)}var h=new(function(){function t(e,i){var r,o,n,s=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,n=function(){s._toggleButtonState(s._button)},(o=c(o="resetValidation"))in r?Object.defineProperty(r,o,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[o]=n,this._config=e,this._form=document.querySelector("".concat(i)),this._button=this._form.querySelector(".form__button-submit"),this._inputList=Array.from(this._form.querySelectorAll("".concat(this._config.selectSelector,",\n      ").concat(this._config.inputDateSelector,",\n      ").concat(this._config.inputTimeSelector,",\n      ").concat(this._config.textareaSelector))),this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._startTimeInput=this._form.querySelector(e.startTimeSelector),this._endTimeInput=this._form.querySelector(e.endTimeSelector)}var e,i;return e=t,(i=[{key:"_isTimeValid",value:function(t){return this._hours=parseInt(t.split(":")[0]),this._minutes=parseInt(t.split(":")[1]),this._hours>=9&&this._hours<21||21===this._hours&&0===this._minutes}},{key:"_checkDateTimeValidity",value:function(){this._startTime=new Date("2023-01-01T".concat(this._startTimeInput.value,":00")),this._endTime=new Date("2023-01-01T".concat(this._endTimeInput.value,":00")),this._diffInMs=this._endTime-this._startTime,this._diffInHours=this._diffInMs/36e5,this._diffInHours<1||!this._isTimeValid(this._startTimeInput.value)||!this._isTimeValid(this._endTimeInput.value)?(this._showInputError(this._endTimeInput,"Интервал времени должен быть не меньше 1 часа. Доступное время для бронирования: c 09:00 до 21:00"),this._isDateTimeValid=!1):(this._hideInputError(this._endTimeInput),this._isDateTimeValid=!0)}},{key:"_showInputError",value:function(t,e){this._errorElement=this._form.querySelector(".".concat(t.id,"-error")),t.classList.add(this._inputErrorClass),this._errorElement.textContent=e,this._errorElement.classList.add(this._errorClass)}},{key:"_hideInputError",value:function(t){this._errorElement=this._form.querySelector(".".concat(t.id,"-error")),t.classList.remove(this._inputErrorClass),this._errorElement.classList.remove(this._errorClass),this._errorElement.textContent=""}},{key:"_checkInputValidity",value:function(t){t.validity.valid?this._hideInputError(t):this._showInputError(t,t.validationMessage),t!==this._startTimeInput&&t!==this._endTimeInput||this._checkDateTimeValidity()}},{key:"_toggleButtonState",value:function(t){this._isValid=this._inputList.every((function(t){return t.validity.valid})),this._isValid&&this._isDateTimeValid?(t.classList.remove(this._inactiveButtonClass),t.disabled=!1):(t.classList.add(this._inactiveButtonClass),t.disabled=!0)}},{key:"_setEventListeners",value:function(){var t=this;this._buttonElement=this._form.querySelector(this._submitButtonSelector),this._form.addEventListener("submit",(function(t){t.preventDefault()})),this._inputList.forEach((function(e){e.addEventListener("input",(function(){t._checkInputValidity(e),t._toggleButtonState(t._buttonElement)}))})),this._toggleButtonState(this._buttonElement)}},{key:"enableValidation",value:function(){this._setEventListeners()}}])&&l(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}())({formSelector:".form",selectSelector:".form__select",inputDateSelector:".form__date-input",inputTimeSelector:".form__time-input",textareaSelector:".form__textarea",submitButtonSelector:".form__button-submit",startTimeSelector:"#start-time",endTimeSelector:"#end-time",dateTimeErrorSelector:".date-time-error",inactiveButtonClass:"button_disabled",inputErrorClass:"form_type_error",errorClass:"form__error_visible"},".form");h.enableValidation();var _=new i(".page__popup-success");_.setEventListeners();var m=new a({formSelector:".form",checkValid:h.resetValidation,openPopup:function(){_.open()}});m.setEventListeners(),m.setOptions(),m.setMinAndMaxDate()})();